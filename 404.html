<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- META  -->
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Hub of Fyodrik's Activity, Fyodrik's personal site, Fyodrik's portfolio">
        <meta name="keywords" content="Fyodrik, IT, Technologies, Sound, Music, Graphics, Video, Projects, Audial, Visual, Tech">
        <meta name="author" content="Fyodrik (Dmitry Fyodorov)">
    <!-- STYLES & CONTENT  -->
        <link rel="shortcut icon" href='https://fyodrik.github.io/!app/img/favicon.ico'>
        <link rel="stylesheet" href="https://fyodrik.github.io/!app/css/main.css">
</head>
<body>
    <!--CONTENT-->
        <div id="header">
            <div style="float:left;">
                    <a class="nav" href="about" style="font-weight: bold;background:rgb(255,25,0);"> &nbsp; Dmitry Fyodorov (aka Fyodrik)</a>
            </div>
            <ul id="nav-filter-menu">
                <li><a id="tech" class="nav" href="tech">Tech</a></li>
                <li><a id="audial" class="nav" href="audial">Audial</a></li>
                <li><a id="visual" class="nav" href="visual">Visual</a></li>
                <li><a id="other" class="nav" href="other">Other</a></li>
            </ul>
        </div>
        <div id="wrap-content">
            <div id="content">404</div>
        </div>
    <!--SCRIPTS-->
        <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
        <!--[if IE]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <script>
            function adaptiveContentHeight(){
                if(window.innerHeight-54<=500)
                    $('#content').css({
                        'height':'550px'
                    });
                else
                    $('#content').css({
                        'height':window.innerHeight-54+'px'
                    });
                $('#content').css({
                        'opacity':1
                    });
            }

            window.addEventListener("load", adaptiveContentHeight);
            window.addEventListener("resize", adaptiveContentHeight);
        </script>
        <script>
            // (C) 2015 Dmitry Fyodorov (aka Fyodrik)
            // Router.js - браузерная маршрутизация для AJAX-подзагрузки
            // Венгерская нотация
            ; var strCurLoc = location.toString(), strSiteDomen = "https://fyodrik.github.io/";

            //Обновление состояния

            var updateState = function(state){
                var strUrlHash = replaceSlash(state.page);

                //Выделение пункта меню
                $('#nav-filter-menu li a').removeClass("nav-focus");
                $('#'+strUrlHash).addClass("nav-focus");

                //AJAX LOADING
                $('#content').load("https://fyodrik.github.io/!app/loading.html");

                console.log(strUrlHash);
                // //Проверка на якорь
                // if(!state)
                //     if(location.hash.slice(1)=="")
                //         strUrlHash = null;
                //     else
                //         return;

                // //Проход по таблице маршрутизации
                // $.getJSON("!app/js/routersDB.json", function(jsonRouters){
                //     for(var i = 0; i<jsonRouters.List.length; i++)
                //         if(location.pathname.slice(1)==jsonRouters.List[i].UrlHash){
                //             //if(strCurLoc!=jsonRouters.List[i].FromLoc){
                //             //   exit_n();
                //             //}
                //             //else{}
                //             //  exit();
                //             document.querySelector('title').innerHTML = jsonRouters.List[i].Title;
                //             $('body').css({
                //                 'filter': 'grayscale(0%)',
                //                 '-webkitFilter':'grayscale(0%)'
                //             });
                //             $('#content').load(jsonRouters.List[i].FromLoc+jsonRouters.List[i].ContentLink);
                //             return;
                //         }
                //     document.querySelector('title').innerHTML = "404 Error";
                //     $('body').css({
                //         'filter': 'grayscale(100%)',
                //         '-webkitFilter':'grayscale(100%)'
                //     });
                //     document.getElementById("content").innerHTML = '<h1 class="title" style="text-align:center;width:100%;">Error 404. This resource is not available on the site.</h1>';
                // });
            }

            //изменение поля адреса

            var update = function(){
                var strHashRef;
                //Проверка на якорь
                if(strCurLoc!= strSiteDomen && location.hash.slice(1)=="")
                    strHashRef = location.pathname.slice(1);
                else
                    strHashRef = location.hash.slice(1);
                var state = {
                    page:sliceSlash(strHashRef)
                };

                console.log(state);

                history.pushState(state,'',state.page);
                updateState(state);
            }

            window.addEventListener("hashchange", update);
            window.addEventListener("load", update);

            //Ссылки навигации и переходы по истории

            $('a.nav').bind("click", function(e){
                var state = {
                    page: e.target.getAttribute("href")
                };

                history.pushState(state,'',state.page);
                updateState(state);
                e.preventDefault();
            });

            window.addEventListener('popstate', function(e){updateState(e.state);});

            var sliceSlash = function(page){
                var str = page; // ищем в этой строке
                var target = "/"; // цель поиска
                var i;
                var pos = 0;
                while (true) {
                  var foundPos = str.indexOf(target, pos);
                  if (foundPos == -1) break;
                  else i = foundPos;
                  console.log( i ); // нашли на этой позиции
                  pos = foundPos + 1; // продолжить поиск со следующей
                }
                return str.slice(i+1); // нашли на этой позиции
            }
            var replaceSlash = function(page){
                return page.replace(/\//g, "_");
            }
        </script>
</body>
</html>